// Minified by local_questions build script.
(()=>{/**
 * Flagging module for question reports.
 *
 * @module     local_questions/flagging
 * @copyright  2026 Sergio C.
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */define(["jquery","core/ajax","core/notification","core/str"],function(a,d,c,r){let t=0;const f=function(){a(document).on("click",".local-questions-flag-btn:not(.disabled)",function(e){e.preventDefault(),t=a(this).data("questionid"),a("#flag-questionid").val(t),l()}),a(document).on("click","#submit-flag-btn",function(e){e.preventDefault(),u()}),a("#local-questions-flag-modal").on("hidden.bs.modal",function(){l()})},l=function(){a("#flag-reason").val("").removeClass("is-invalid"),a("#flag-comment").val(""),a("#flag-success-message").addClass("d-none"),a("#flag-error-message").addClass("d-none"),a("#submit-flag-btn").prop("disabled",!1)},u=function(){const e=a("#flag-reason").val(),o=a("#flag-comment").val().trim();if(!e){a("#flag-reason").addClass("is-invalid");return}a("#flag-reason").removeClass("is-invalid"),a("#submit-flag-btn").prop("disabled",!0);const n=new URLSearchParams(window.location.search),g=parseInt(n.get("attempt"))||0;d.call([{methodname:"local_questions_submit_flag",args:{questionid:t,reason:e,comment:o,attemptid:g}}])[0].done(function(s){s.success?(a("#flag-success-message").removeClass("d-none"),a("#flag-error-message").addClass("d-none"),m(t),setTimeout(function(){const b=document.getElementById("local-questions-flag-modal");if(typeof bootstrap<"u"&&bootstrap.Modal){const i=bootstrap.Modal.getInstance(b);i&&i.hide()}else a("#local-questions-flag-modal").modal("hide")},1500)):(a("#flag-error-text").text(s.message),a("#flag-error-message").removeClass("d-none"),a("#submit-flag-btn").prop("disabled",!1))}).fail(function(s){c.exception(s),a("#submit-flag-btn").prop("disabled",!1)})},m=function(e){const o=a('.local-questions-flag-btn[data-questionid="'+e+'"]');r.get_string("alreadyflagged","local_questions").done(function(n){o.removeClass("btn-outline-warning").addClass("btn-warning disabled").prop("disabled",!0).attr("title",n).html('<i class="fa fa-flag"></i> <span class="ms-1">'+n+"</span>")})};return{init:f}});})();
