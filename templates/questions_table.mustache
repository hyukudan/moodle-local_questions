<div class="questions-view">
    <form class="form-inline mb-3">
        <label class="mr-2" for="category-select">Select Category:</label>
        <select class="custom-select mr-3" id="category-select" onchange="window.location.href='?tab=questions&cat='+this.value">
            <option value="0">Choose...</option>
            {{#options}}
            <option value="{{id}}" {{#selected}}selected{{/selected}}>{{name}}</option>
            {{/options}}
        </select>
        
        <div class="custom-control custom-checkbox my-1 mr-sm-2">
            <input type="checkbox" class="custom-control-input" id="recurse-check" {{#recurse}}checked{{/recurse}} onchange="var url = new URL(window.location.href); url.searchParams.set('recurse', this.checked ? 1 : 0); window.location.href = url.toString();">
            <label class="custom-control-label" for="recurse-check">Include subcategories</label>
        </div>
    </form>

    {{#hasquestions}}
    <div class="table-responsive">
        <table class="table table-bordered table-hover" id="questions-table">
            <thead class="thead-light">
                <tr>
                    <th scope="col" style="width: 50px;">#</th>
                    <th scope="col">Question Text</th>
                    <th scope="col">Answers</th>
                    <th scope="col">Type</th>
                    <th scope="col" style="width: 100px;">Actions</th>
                </tr>
            </thead>
            <tbody>
                {{#questions}}
                <tr data-id="{{id}}">
                    <td>{{id}}</td>
                    <td contenteditable="true" class="inplace-edit" data-field="questiontext">{{questiontext}}</td>
                    <td>
                        {{#hasanswers}}
                        <ul class="list-unstyled mb-0">
                            {{#answers}}
                            <li class="mb-1">
                                <span contenteditable="true" class="inplace-edit {{class}}" data-field="answer" data-answerid="{{id}}">{{answer}}</span>
                                <small class="text-muted d-block pl-2">Feedback: <span contenteditable="true" class="inplace-edit" data-field="feedback" data-answerid="{{id}}">{{feedback}}</span></small>
                            </li>
                            {{/answers}}
                        </ul>
                        {{/hasanswers}}
                        {{^hasanswers}}
                        <em class="text-muted">No answers (Description or Manual)</em>
                        {{/hasanswers}}
                    </td>
                    <td>{{qtype}}</td>
                    <td>
                        <button class="btn btn-sm btn-primary save-row" style="display:none;">Save</button>
                    </td>
                </tr>
                {{/questions}}
            </tbody>
        </table>
    </div>
    <div class="mt-3">
         <button id="batch-save-btn" class="btn btn-success" style="display:none;">Save All Changes</button>
    </div>
    {{/hasquestions}}

    {{^hasquestions}}
        {{#selectedcategory}}
        <div class="alert alert-info">No questions found in this category.</div>
        {{/selectedcategory}}
        {{^selectedcategory}}
        <div class="alert alert-warning">Please select a category.</div>
        {{/selectedcategory}}
    {{/hasquestions}}
</div>

{{#js}}
require(['local_questions/quickedit'], function(QuickEdit) {
    QuickEdit.init();
});
{{/js}}
