<div class="modal fade" id="ai-review-modal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-scrollable" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">AI Assessment Analysis</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body p-0">
                <div id="ai-loading" class="text-center p-5">
                    <div class="spinner-border text-primary" role="status">
                        <span class="sr-only">Loading...</span>
                    </div>
                    <p class="mt-2" id="ai-loading-text">Analyzing questions with Gemini...</p>
                </div>

                <div id="ai-results" style="display:none;">
                    <div class="alert alert-info m-3">
                        Reviwe generated suggestions. Click "Apply" to accept individual changes, or "Apply All" to accept everything.
                    </div>
                    <div class="accordion" id="ai-suggestions-list">
                        <!-- Suggestions will be injected here -->
                    </div>
                </div>
                
                <div id="ai-error" class="alert alert-danger m-3" style="display:none;"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-success" id="ai-apply-all" style="display:none;">Apply All Changes</button>
            </div>
        </div>
    </div>
</div>

<script type="text/template" id="tpl-ai-suggestion">
    <div class="card m-2 border-warning">
        <div class="card-header bg-warning text-dark d-flex justify-content-between align-items-center" id="heading-{{id}}">
            <h6 class="mb-0">
                Question ID: {{id}}
                <span class="badge badge-dark ml-2">{{issueCount}} issues</span>
            </h6>
        </div>

        <div class="collapse show">
            <div class="card-body">
                <ul class="list-group list-group-flush mb-3">
                    {{#issues}}
                    <li class="list-group-item list-group-item-warning"><i class="fa fa-exclamation-triangle mr-2"></i> {{.}}</li>
                    {{/issues}}
                </ul>

                <table class="table table-sm table-bordered">
                    <thead>
                        <tr>
                            <th>Field</th>
                            <th>Original</th>
                            <th>Suggested</th>
                            <th style="width:80px;">Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        {{#suggestions}}
                        <tr class="suggestion-row" data-qid="{{id}}" data-field="{{field}}">
                            <td><small class="text-muted">{{field}}</small></td>
                            <td class="text-danger"><del>{{original}}</del></td>
                            <td class="text-success">{{suggested}}</td>
                            <td>
                                <button class="btn btn-sm btn-outline-success btn-apply-change">Apply</button>
                            </td>
                        </tr>
                        {{/suggestions}}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</script>
